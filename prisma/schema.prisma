datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id               String         @id @default(cuid())
  email            String         @unique
  name             String?
  password         String?
  provider         Provider
  role             Role           @default(user)
  forms            Form[]         @relation("user")
  stripeCustomerId String?
  subscriptions    Subscription[]
  Payment          Payment[]
  maxForms         Int            @default(5) // Maximum number of forms user can create (default is 5 for free users)
}

model Template {
  id           String   @id @default(cuid())
  name         String
  description  String?
  previewImage String?
  theme        String?
  fontFamily   String?
  screens      Screen[] @relation("templateScreens")
}

model Form {
  id         String   @id @default(cuid())
  name       String?
  published  Boolean  @default(false)
  theme      String?
  fontFamily String?
  screens    Screen[]
  userId     String?
  user       User?    @relation(fields: [userId], references: [id], name: "user", onDelete: Cascade)

  formResponses FormResponse[]
}

model FormResponse {
  id           String   @id @default(cuid())
  form         Form     @relation(fields: [formId], references: [id], onDelete: Cascade)
  formId       String
  submittedAt  DateTime @default(now())
  responseData Json
}

model Screen {
  id          String     @id @default(cuid())
  type        ScreenType
  title       String
  description String?
  buttonText  String?
  scale       Int?
  order       Int?
  required    Boolean    @default(false)
  form        Form?      @relation(fields: [formId], references: [id], onDelete: Cascade)
  formId      String?
  template    Template?  @relation(fields: [templateId], references: [id], name: "templateScreens", onDelete: Cascade)
  templateId  String?
  rightLabel  String?
  leftLabel   String?
  options     Option[]
}

model Option {
  id       String  @id @default(cuid())
  label    String
  value    String
  imageUrl String?
  screen   Screen  @relation(fields: [screenId], references: [id], onDelete: Cascade)
  screenId String
}

model Subscription {
  id                   String             @id @default(cuid())
  user                 User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId               String
  stripeSubscriptionId String
  plan                 SubscriptionPlan
  status               SubscriptionStatus @default(active)
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @updatedAt
}

model Payment {
  id                    String        @id @default(cuid())
  amount                Int
  currency              String
  status                PaymentStatus
  user                  User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId                String
  stripePaymentIntentId String
  createdAt             DateTime      @default(now())
  updatedAt             DateTime      @updatedAt
}

enum ScreenType {
  welcomeScreen
  short_text
  long_text
  multiple_choice
  dropdown
  date
  rating
  boolean
  email
  website
  file_upload
  number
  opinion_scale
  picture_choice
  endScreen
}

enum Provider {
  Google
  Credentials
}

enum Role {
  user
  admin
}

enum SubscriptionPlan {
  FREE
  BASIC
  PREMIUM
}

enum SubscriptionStatus {
  active
  canceled
  past_due
  unpaid
}

enum PaymentStatus {
  succeeded
  pending
  failed
}
